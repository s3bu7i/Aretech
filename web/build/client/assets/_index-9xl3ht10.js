import{r as x,j as l,s as G}from"./index-b9mOX-ty.js";import{I as Z}from"./input-BmNbZnrl.js";import{u as I}from"./store-DN2nkw-m.js";import{J as M}from"./index-BJkUeisO.js";import{a as K}from"./index-Cw6jCe4l.js";import{c as ee}from"./createLucideIcon-CP5-0Dwr.js";import"./utils-DnNDQBbQ.js";import"./index-DaFgVfeA.js";/**
 * @license lucide-react v0.441.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=ee("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ne="/assets/trees-DVZJVNjm.webp",F=new Set,h=new WeakMap,C=new WeakMap,E=new WeakMap,$=new WeakMap,oe=new WeakMap,T=new WeakMap,W=new WeakMap,k=new WeakSet;let N,_=0,Y=0;const v="__aa_tgt",P="__aa_del",A="__aa_new",se=e=>{const t=de(e);t&&t.forEach(n=>fe(n))},ie=e=>{e.forEach(t=>{t.target===N&&ae(),h.has(t.target)&&j(t.target)})};function re(e){const t=$.get(e);t==null||t.disconnect();let n=h.get(e),o=0;const s=5;n||(n=O(e),h.set(e,n));const{offsetWidth:a,offsetHeight:r}=N,c=[n.top-s,a-(n.left+s+n.width),r-(n.top+s+n.height),n.left-s].map(f=>`${-1*Math.floor(f)}px`).join(" "),m=new IntersectionObserver(()=>{++o>1&&j(e)},{root:N,threshold:1,rootMargin:c});m.observe(e),$.set(e,m)}function j(e){clearTimeout(W.get(e));const t=B(e),n=L(t)?500:t.duration;W.set(e,setTimeout(async()=>{const o=E.get(e);try{await(o==null?void 0:o.finished),h.set(e,O(e)),re(e)}catch{}},n))}function ae(){clearTimeout(W.get(N)),W.set(N,setTimeout(()=>{F.forEach(e=>Q(e,t=>V(()=>j(t))))},100))}function ce(e){setTimeout(()=>{oe.set(e,setInterval(()=>V(j.bind(null,e)),2e3))},Math.round(2e3*Math.random()))}function V(e){typeof requestIdleCallback=="function"?requestIdleCallback(()=>e()):requestAnimationFrame(()=>e())}let z,S;const le=typeof window<"u"&&"ResizeObserver"in window;le&&(N=document.documentElement,z=new MutationObserver(se),S=new ResizeObserver(ie),window.addEventListener("scroll",()=>{Y=window.scrollY,_=window.scrollX}),S.observe(N));function de(e){return e.reduce((o,s)=>[...o,...Array.from(s.addedNodes),...Array.from(s.removedNodes)],[]).every(o=>o.nodeName==="#comment")?!1:e.reduce((o,s)=>{if(o===!1)return!1;if(s.target instanceof Element){if(R(s.target),!o.has(s.target)){o.add(s.target);for(let a=0;a<s.target.children.length;a++){const r=s.target.children.item(a);if(r){if(P in r)return!1;R(s.target,r),o.add(r)}}}if(s.removedNodes.length)for(let a=0;a<s.removedNodes.length;a++){const r=s.removedNodes[a];if(P in r)return!1;r instanceof Element&&(o.add(r),R(s.target,r),C.set(r,[s.previousSibling,s.nextSibling]))}}return o},new Set)}function R(e,t){!t&&!(v in e)?Object.defineProperty(e,v,{value:e}):t&&!(v in t)&&Object.defineProperty(t,v,{value:e})}function fe(e){var t;const n=e.isConnected,o=h.has(e);n&&C.has(e)&&C.delete(e),E.has(e)&&((t=E.get(e))===null||t===void 0||t.cancel()),A in e?D(e):o&&n?me(e):o&&!n?pe(e):D(e)}function w(e){return Number(e.replace(/[^0-9.\-]/g,""))}function ue(e){let t=e.parentElement;for(;t;){if(t.scrollLeft||t.scrollTop)return{x:t.scrollLeft,y:t.scrollTop};t=t.parentElement}return{x:0,y:0}}function O(e){const t=e.getBoundingClientRect(),{x:n,y:o}=ue(e);return{top:t.top+o,left:t.left+n,width:t.width,height:t.height}}function J(e,t,n){let o=t.width,s=t.height,a=n.width,r=n.height;const d=getComputedStyle(e);if(d.getPropertyValue("box-sizing")==="content-box"){const m=w(d.paddingTop)+w(d.paddingBottom)+w(d.borderTopWidth)+w(d.borderBottomWidth),f=w(d.paddingLeft)+w(d.paddingRight)+w(d.borderRightWidth)+w(d.borderLeftWidth);o-=f,a-=f,s-=m,r-=m}return[o,a,s,r].map(Math.round)}function B(e){return v in e&&T.has(e[v])?T.get(e[v]):{duration:250,easing:"ease-in-out"}}function U(e){if(v in e)return e[v]}function q(e){const t=U(e);return t?k.has(t):!1}function Q(e,...t){t.forEach(n=>n(e,T.has(e)));for(let n=0;n<e.children.length;n++){const o=e.children.item(n);o&&t.forEach(s=>s(o,T.has(o)))}}function X(e){return Array.isArray(e)?e:[e]}function L(e){return typeof e=="function"}function me(e){const t=h.get(e),n=O(e);if(!q(e))return h.set(e,n);let o;if(!t)return;const s=B(e);if(typeof s!="function"){const a=t.left-n.left,r=t.top-n.top,[d,c,m,f]=J(e,t,n),g={transform:`translate(${a}px, ${r}px)`},p={transform:"translate(0, 0)"};d!==c&&(g.width=`${d}px`,p.width=`${c}px`),m!==f&&(g.height=`${m}px`,p.height=`${f}px`),o=e.animate([g,p],{duration:s.duration,easing:s.easing})}else{const[a]=X(s(e,"remain",t,n));o=new Animation(a),o.play()}E.set(e,o),h.set(e,n),o.addEventListener("finish",j.bind(null,e))}function D(e){A in e&&delete e[A];const t=O(e);h.set(e,t);const n=B(e);if(!q(e))return;let o;if(typeof n!="function")o=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:n.duration*1.5,easing:"ease-in"});else{const[s]=X(n(e,"add",t));o=new Animation(s),o.play()}E.set(e,o),o.addEventListener("finish",j.bind(null,e))}function H(e,t){var n;e.remove(),h.delete(e),C.delete(e),E.delete(e),(n=$.get(e))===null||n===void 0||n.disconnect(),setTimeout(()=>{if(P in e&&delete e[P],Object.defineProperty(e,A,{value:!0,configurable:!0}),t&&e instanceof HTMLElement)for(const o in t)e.style[o]=""},0)}function pe(e){var t;if(!C.has(e)||!h.has(e))return;const[n,o]=C.get(e);Object.defineProperty(e,P,{value:!0,configurable:!0});const s=window.scrollX,a=window.scrollY;if(o&&o.parentNode&&o.parentNode instanceof Element?o.parentNode.insertBefore(e,o):n&&n.parentNode?n.parentNode.appendChild(e):(t=U(e))===null||t===void 0||t.appendChild(e),!q(e))return H(e);const[r,d,c,m]=ge(e),f=B(e),g=h.get(e);(s!==_||a!==Y)&&he(e,s,a,f);let p,y={position:"absolute",top:`${r}px`,left:`${d}px`,width:`${c}px`,height:`${m}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!L(f))Object.assign(e.style,y),p=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:f.duration,easing:"ease-out"});else{const[i,u]=X(f(e,"remove",g));(u==null?void 0:u.styleReset)!==!1&&(y=(u==null?void 0:u.styleReset)||y,Object.assign(e.style,y)),p=new Animation(i),p.play()}E.set(e,p),p.addEventListener("finish",H.bind(null,e,y))}function he(e,t,n,o){const s=_-t,a=Y-n,r=document.documentElement.style.scrollBehavior;if(getComputedStyle(N).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+s,window.scrollY+a),!e.parentElement)return;const c=e.parentElement;let m=c.clientHeight,f=c.clientWidth;const g=performance.now();function p(){requestAnimationFrame(()=>{if(!L(o)){const y=m-c.clientHeight,i=f-c.clientWidth;g+o.duration>performance.now()?(window.scrollTo({left:window.scrollX-i,top:window.scrollY-y}),m=c.clientHeight,f=c.clientWidth,p()):document.documentElement.style.scrollBehavior=r}})}p()}function ge(e){const t=h.get(e),[n,,o]=J(e,t,O(e));let s=e.parentElement;for(;s&&(getComputedStyle(s).position==="static"||s instanceof HTMLBodyElement);)s=s.parentElement;s||(s=document.body);const a=getComputedStyle(s),r=h.get(s)||O(s),d=Math.round(t.top-r.top)-w(a.borderTopWidth),c=Math.round(t.left-r.left)-w(a.borderLeftWidth);return[d,c,n,o]}function ye(e,t={}){return z&&S&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!L(t)&&!t.disrespectUserMotionPreference||(k.add(e),getComputedStyle(e).position==="static"&&Object.assign(e.style,{position:"relative"}),Q(e,j,ce,s=>S==null?void 0:S.observe(s)),L(t)?T.set(e,t):T.set(e,{duration:250,easing:"ease-in-out",...t}),z.observe(e,{childList:!0}),F.add(e))),Object.freeze({parent:e,enable:()=>{k.add(e)},disable:()=>{k.delete(e)},isEnabled:()=>k.has(e)})}function we(e){const[t,n]=x.useState(),o=x.useMemo(()=>e,[]),s=x.useCallback(r=>{r instanceof HTMLElement?n(ye(r,o)):n(void 0)},[o]),a=x.useCallback(r=>{t&&(r?t.enable():t.disable())},[t]);return[s,a]}const Oe=()=>[{title:"EcoRewards"},{name:"description",content:"Earn rewards by eco-friendly actions"}];function Me(){var y;const[e]=K(),t=((y=e.get("query"))==null?void 0:y.toLowerCase())||"",[n,o]=x.useState([]),s=I(i=>i.balance),a=I(i=>i.setBal),r=I(i=>i.memberId),[d,c]=x.useState(!1);x.useEffect(()=>{fetch(window.ENV.API_URL+"/api/v1/rewards/getAll").then(i=>i.json()).then(i=>{o(i.rewards),console.log(i)})},[]);const[m]=we();console.log(n);const g=n.filter(i=>(i.name.toLowerCase().includes(t)||i.category.toLowerCase().includes(t))&&!(i.id===10||i.id===11)).reduce((i,u)=>(i[u.category]||(i[u.category]=[]),i[u.category].push(u),i),{}),p=async i=>{if(d){M.error("Still processing last transaction!");return}if(c(!0),s<i.points){M.error("You don't have enough ecopoints!"),c(!1);return}const u=localStorage.getItem("accessToken");if(!u){M.error("Cannot find access token, please sign in again"),c(!1);return}if(!r){M.error("Unknown member id error"),c(!1);return}console.log("member id",r);const b=await fetch(window.ENV.API_URL+`/api/v1/loyalty/${r}/transactions`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify({category:i.category,description:`Purchase ${i.name}`,points:5e3,rewardId:i.id,amount:i.points})});console.log("transaction",b),M.success(`Bought ${i.name} successfully`),a(s-i.points),c(!1)};return l.jsxs("div",{className:"flex flex-col items-center justify-center",children:[l.jsx(be,{className:"relative w-full"}),l.jsxs("div",{className:"flex flex-col w-full mt-4 h-screen",children:[l.jsxs("div",{className:"rounded-lg w-full p-8",style:{backgroundImage:`url(${ne})`,backgroundSize:"cover",backgroundPosition:"center"},children:[l.jsx("h1",{className:"text-4xl font-bold text-white",children:"Carbon Offsets"}),l.jsx("p",{className:"text-gray-300 text-sm mt-3",children:"Offset your carbon footprint by redeeming your points to support projects that reduce greenhouse gas emissions like tree planting."}),l.jsx("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg mt-4 hover:opacity-90 transition-opacity",onClick:()=>{var i;(i=document.getElementById("rewards"))==null||i.scrollIntoView()},children:"Learn More →"})]}),l.jsxs("div",{className:"flex flex-col w-full mt-4",id:"rewards",ref:m,children:[Object.entries(g).map(([i,u])=>l.jsxs("div",{className:"flex flex-col w-full mt-4",children:[l.jsx("h2",{className:"text-2xl font-bold",children:i}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4",children:u.map(b=>l.jsxs("div",{className:"rounded-lg bg-white shadow-md p-4",children:[l.jsx("img",{src:b.image,alt:String(b.name),className:"w-full h-40 object-cover rounded-lg"}),l.jsx("h3",{className:"text-xl font-bold mt-2",children:b.name}),l.jsx("p",{className:"text-gray-500 mt-1",children:b.description}),l.jsxs("button",{className:"bg-green-600 text-white px-4 py-2 rounded-lg mt-4",onClick:()=>p(b),children:[b.points.toLocaleString()," Points"]})]},b.id))})]},i)),JSON.stringify(g)==="{}"&&l.jsx("p",{className:"text-center text-xl mt-4",children:"No rewards found"})]})]})]})}function be(e){const t=G(),[n,o]=x.useState(""),s=a=>{if(a.preventDefault(),console.log(n===""),n.trim()===""||n===null||n===void 0||n===" "||n===""){t("/");return}t(`/?query=${n}`)};return l.jsxs("form",{className:"relative top-0 w-full",onSubmit:s,...e,children:[l.jsx(Z,{className:"w-full [outline:none!important]",placeholder:"What are you looking for?",value:n,onChange:a=>o(a.target.value),name:"search",autoComplete:"off"}),l.jsx("button",{type:"submit",className:"absolute right-4 top-1/2 -translate-y-1/2",children:l.jsx(te,{className:"text-gray-600 h-4 w-4 fill-current"})})]})}export{Me as default,Oe as meta};
